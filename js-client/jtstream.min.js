/*
 * This file is part of the jtstream package.
 *
 * (c) 2014 Jan Thomas <jan.thomas@rwth-aachen.de>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code (licensed MIT).
 */
!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.jtstream=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";var c=a("./util/private.js"),d=(a("./util/barrier.js"),c.noop),e=c.uniqueId,f=c.extend,g=c.setQueryParams,h=a("./util/public.js"),i=function(){this.registerDefaultCallbacks(),this.init()};i.prototype.registerCallback=function(a,b){this.partCallbacks[a]=b},i.prototype.getCallback=function(a){return this.partCallbacks[a]},i.prototype.registerDefaultCallbacks=function(){this.partCallbacks={},this.registerCallback("html",a("./part/html.js")),this.registerCallback("resource",a("./part/resource.js")),this.registerCallback("css",a("./part/css.js")),this.registerCallback("js",a("./part/js.js")),this.registerCallback("pagelet",a("./part/pagelet.js"))},i.prototype.init=function(a){a=a||{},this.util=f({},h,a.util),this.onStreamStart=a.onStreamStart||d,this.onProcess=a.onProcess||d,this.onProcessed=a.onProcessed||d,this.onStreamEnd=a.onStreamEnd||d,this._started=!1,this._ended=!1},i.prototype.process=function(a){var b=this.partCallbacks,c=a.type;if(!b[c])throw new Error("invalid type: "+c+", valid types are: "+Object.keys(b).join(","));this.sos(a),this.onProcess(c,a,this)!==!1&&(this.util.log("process part for stream: "+(this._id?this._id:"main")),this.util.log(a),b[c](this,a),this.onProcessed(c,a,this))},i.prototype.sos=function(a){this._started!==!0&&(this.util.log("stream started: "+(this._id?this._id:"main")),this.util.log(a),this.onStreamStart(a,this),this._started=!0,this._ended=!1)},i.prototype.eos=function(a){this._ended!==!0&&(this.util.log("stream ended: "+(this._id?this._id:"main")),this.util.log(a),this.onStreamEnd(a,this),this._started=!1,this._ended=!0)};var j=new i,k=function(a){this.url=a,this.registerDefaultCallbacks(),this.init()};k.prototype=j,k.prototype.open=function(){if(!this.url)throw new Error("Can not open url stream for empty url");var a=this,b=document.body,c=document.createElement("iframe"),d=g(this.url,{_jtstreamid:this._id}),e=function(){b.removeChild(c),a.eos&&a.eos(a)};c.style.display="none",c.setAttribute("src",d),c.attachEvent?c.attachEvent("onload",e):c.addEventListener("load",e,!1),b.appendChild(c)},j.createURLStream=function(a,b){var c=new k(a);return this.install(c,b||{}),c},j.install=function(a,b){var c=b.id||e();this[a._id=c]=a,a.init(b)},window&&window.__DEV__&&(j.require=a),b.exports=j},{"./part/css.js":2,"./part/html.js":3,"./part/js.js":4,"./part/pagelet.js":5,"./part/resource.js":6,"./util/barrier.js":7,"./util/private.js":8,"./util/public.js":9}],2:[function(a,b){"use strict";b.exports=function(a,b){a.util.evalStyle(b.text||"")}},{}],3:[function(a,b){"use strict";b.exports=function(a,b){a.util[b.mode||"replace"](b.id,b.html)}},{}],4:[function(a,b){"use strict";b.exports=function(a,b){a.util.evalScript(b.text||"")}},{}],5:[function(a,b){"use strict";var c=a("../util/barrier.js"),d=function(a,b){var d=a.getCallback("js"),e=a.getCallback("resource"),f=new c(function(){var c=b.js||[];c.forEach(function(b){d(a,{text:b})})}),g=b.jsResources||[];g.forEach(function(b){var c={resourceType:"js",resourceUrl:b};e(a,c,f.getRelease())}),f.getRelease()()},e=function(a,b){var c=a.getCallback("css"),d=a.getCallback("resource"),e=b.cssResources||[];e.forEach(function(b){d(a,{resourceType:"css",resourceUrl:b})});var f=b.css||[];f.forEach(function(b){c(a,{text:b})})};b.exports=function(a,b){var c=a.getCallback("html");e(a,b),c(a,b),d(a,b)}},{"../util/barrier.js":7}],6:[function(a,b){"use strict";var c={};b.exports=function(a,b,d){var e=b.resourceUrl,f=b.resourceType;if("js"!=f&&"css"!=f)throw new Error("invalid resource type: "+f);if(c.hasOwnProperty(e))return void(c[e]===!0?d&&d():d&&c[e].push(d));c[e]=[d];var g=function(){var a=c[e];a.forEach(function(a){a&&a()}),c[e]=!0};"js"==f?a.util.requireScript(e,g):"css"==f&&a.util.requireStyle(e,g)}},{}],7:[function(a,b){"use strict";var c=function(a){var b=this;b.callback=a,b.called=!1,b.count=0,b._release=function(){b.called||--b.count<1&&(b.callback(),b.called=!0)}};c.prototype.getRelease=function(){return++this.count,this._release},b.exports=c},{}],8:[function(a,b){"use strict";var c=0;b.exports={noop:function(){},uniqueId:function(){var a=function(){return(1+65536*Math.random()|0).toString(16).substring(1)};return a()+a()+"-"+ ++c},extend:function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){if(b)for(var c in b)a[c]=b[c]}),a},serializeQueryString:function(a){var b=[];return Object.keys(a).forEach(function(c){b[b.length]=encodeURIComponent(c)+"="+encodeURIComponent(a[c])}),b.join("&").replace(/%20/g,"+")},setQueryParams:function(a,c){var d=document.createElement("a");d.href=a;var e={},f=d.search.substr(1).split("&");f.forEach(function(a){var b=a.split("=");""!=b[0]&&(e[b[0]]=b[1])});for(var g in c)e[g]=c[g];return d.search="?"+b.exports.serializeQueryString(e),d.href}}},{}],9:[function(a,b){"use strict";b.exports={replace:function(a,b){var c=document.getElementById(a);c.innerHTML=b},append:function(a,b){var c=document.getElementById(a);c.innerHTML+=b},prepend:function(a,b){var c=document.getElementById(a);c.innerHTML=b+c.innerHTML},requireScript:function(a,b){var c=document.createElement("script"),d=!1;c.src=a,c.onload=c.onreadystatechange=function(){d||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!0,b&&b(),c.onload=c.onreadystatechange=null)},document.getElementsByTagName("head")[0].appendChild(c)},evalScript:function(a){var b=document.createElement("script");b.setAttribute("type","text/javascript"),b.text=a,document.getElementsByTagName("head")[0].appendChild(b)},requireStyle:function(a,b){var c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",a),document.getElementsByTagName("head")[0].appendChild(c),b&&b()},evalStyle:function(a){var b=document.createElement("style");b.type="text/css",b.styleSheet?b.styleSheet.cssText=a:b.innerHTML=a,document.getElementsByTagName("head")[0].appendChild(b)},log:function(a){window&&window.__DEV__&&window.console&&window.console.log(a)}}},{}]},{},[1])(1)});